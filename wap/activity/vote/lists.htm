<!DOCTYPE HTML>
<html lang="zh-lang">
<head>
    <meta charset="utf-8">
    <title>旅游景点投票</title>
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="/wap/wap/dest/css/styles.css?v=222" media="all"/>
    <script src="http://cdn.bootcss.com/jquery/3.1.0/jquery.min.js"></script>
    <script src="/wap/wap/dest/js/all.js"></script>
</head> 
<body class="topic-vote">
    <div class="vote-city">
        <h3>
            所属城市：
            <em id="city"><span city="0">全部</span><i class="down"></i></em>
            <em id="area"><span city="0">全部</span><i class="down"></i></em>
        </h3>
        <div class="city-list" id="j-city-list">
            <div class="bg"></div>
            <div id="cityList">
            <!-- cityList -->
            </div>
        </div>
        <div class="area-list" id="j-area-list">
            <div class="bg"></div>
            <div id="areaList">
            <!-- cityList -->
            </div>
        </div>
    </div>
    <ul class="vote-list">
        <li>
            <em>
                <a href="/wap/activity/vote/detail.htm">
                    <img width="100%" height="100%" data-sizes="auto" data-src="/wap/wap/dest/img/topic/topic-3.jpg" class="lazyload">
                </a>
                <h2><a href="/wap/activity/vote/detail.htm">鼓浪屿鼓浪屿鼓浪屿鼓</a></h2>
                <span>排名：001</span>
                <span class="ticket">票数：1993830</span>
                <button type="button">
                    <i class="vote"><b></b></i>
                    <label>投票</label>
                </button>
            </em>  
        </li>
        <li>
            <em>
                <a href="/wap/activity/vote/detail.htm">
                    <img width="100%" height="100%" data-sizes="auto" data-src="/wap/wap/dest/img/topic/topic-3.jpg" class="lazyload">
                </a>
                <h2><a href="/wap/activity/vote/detail.htm">鼓浪屿鼓浪屿鼓浪屿鼓</a></h2>
                <span>排名：001</span>
                <span class="ticket">票数：1993830</span>
                <button type="button">
                    <i class=""><b></b></i>
                    <label>投票</label>
                </button>
            </em>  
        </li>
        <li>
            <em>
                <a href="/wap/activity/vote/detail.htm">
                    <img width="100%" height="100%" data-sizes="auto" data-src="/wap/wap/dest/img/topic/topic-3.jpg" class="lazyload">
                </a>
                <h2><a href="/wap/activity/vote/detail.htm">鼓浪屿鼓浪屿鼓浪屿鼓</a></h2>
                <span>排名：001</span>
                <span class="ticket">票数：1993830</span>
                <button type="button">
                    <i class=""><b></b></i>
                    <label>投票</label>
                </button>
            </em>  
        </li>
        <li>
            <em>
                <a href="/wap/activity/vote/detail.htm">
                    <img width="100%" height="100%" data-sizes="auto" data-src="/wap/wap/dest/img/topic/topic-3.jpg" class="lazyload">
                </a>
                <h2><a href="/wap/activity/vote/detail.htm">鼓浪屿鼓浪屿鼓浪屿鼓</a></h2>
                <span>排名：001</span>
                <span class="ticket">票数：1993830</span>
                <button type="button">
                    <i class=""><b></b></i>
                    <label>投票</label>
                </button>
            </em>  
        </li>
        <li>
            <em>
                <a href="/wap/activity/vote/detail.htm">
                    <img width="100%" height="100%" data-sizes="auto" data-src="/wap/wap/dest/img/topic/topic-3.jpg" class="lazyload">
                </a>
                <h2><a href="/wap/activity/vote/detail.htm">鼓浪屿鼓浪屿鼓浪屿鼓</a></h2>
                <span>排名：001</span>
                <span class="ticket">票数：1993830</span>
                <button type="button">
                    <i class=""><b></b></i>
                    <label>投票</label>
                </button>
            </em>  
        </li>
        <li>
            <em>
                <a href="/wap/activity/vote/detail.htm">
                    <img width="100%" height="100%" data-sizes="auto" data-src="/wap/wap/dest/img/topic/topic-3.jpg" class="lazyload">
                </a>
                <h2><a href="/wap/activity/vote/detail.htm">鼓浪屿鼓浪屿鼓浪屿鼓</a></h2>
                <span>排名：001</span>
                <span class="ticket">票数：1993830</span>
                <button type="button">
                    <i class=""><b></b></i>
                    <label>投票</label>
                </button>
            </em>  
        </li>
        <li>
            <em>
                <a href="/wap/activity/vote/detail.htm">
                    <img width="100%" height="100%" data-sizes="auto" data-src="/wap/wap/dest/img/topic/topic-3.jpg" class="lazyload">
                </a>
                <h2><a href="/wap/activity/vote/detail.htm">鼓浪屿鼓浪屿鼓浪屿鼓</a></h2>
                <span>排名：001</span>
                <span class="ticket">票数：1993830</span>
                <button type="button">
                    <i class=""><b></b></i>
                    <label>投票</label>
                </button>
            </em>  
        </li>
        <li>
            <em>
                <a href="/wap/activity/vote/detail.htm">
                    <img width="100%" height="100%" data-sizes="auto" data-src="/wap/wap/dest/img/topic/topic-3.jpg" class="lazyload">
                </a>
                <h2><a href="/wap/activity/vote/detail.htm">鼓浪屿鼓浪屿鼓浪屿鼓</a></h2>
                <span>排名：001</span>
                <span class="ticket">票数：1993830</span>
                <button type="button">
                    <i class=""><b></b></i>
                    <label>投票</label>
                </button>
            </em>  
        </li>
        <li>
            <em>
                <a href="/wap/activity/vote/detail.htm">
                    <img width="100%" height="100%" data-sizes="auto" data-src="/wap/wap/dest/img/topic/topic-3.jpg" class="lazyload">
                </a>
                <h2><a href="/wap/activity/vote/detail.htm">鼓浪屿鼓浪屿鼓浪屿鼓</a></h2>
                <span>排名：001</span>
                <span class="ticket">票数：1993830</span>
                <button type="button">
                    <i class=""><b></b></i>
                    <label>投票</label>
                </button>
            </em>  
        </li>
        <li>
            <em>
                <a href="/wap/activity/vote/detail.htm">
                    <img width="100%" height="100%" data-sizes="auto" data-src="/wap/wap/dest/img/topic/topic-3.jpg" class="lazyload">
                </a>
                <h2><a href="/wap/activity/vote/detail.htm">鼓浪屿鼓浪屿鼓浪屿鼓</a></h2>
                <span>排名：001</span>
                <span class="ticket">票数：1993830</span>
                <button type="button">
                    <i class=""><b></b></i>
                    <label>投票</label>
                </button>
            </em>  
        </li>
    </ul>
    <div class="vote-btn">
        <p>确定投票（<i>2</i>/10）</p>
        <p>每小时投票1次</p>
    </div>

    <!-- cityTpl -->
    <script type="text/html" id="cityTpl">
        <ul>
            {{each data as item}}
            <li onclick="choiceCity($(this));" city="{{item.city}}"><span>{{item.name}}</span></li>
            {{/each}}
        </ul> 
    </script>
    <!-- areaTpl -->
    <script type="text/html" id="areaTpl">
        <ul>
            {{each children as item}}
            <li onclick="choiceArea($(this));" city="{{item.city}}"><span>{{item.name}}</span></li>
            {{/each}}
        </ul>
    </script>

    <script>

        var data        =   null,
            append      =   function(el, html){
                                var divTemp  = document.createElement("div"),
                                    nodes    = null,
                                    fragment = document.createDocumentFragment();

                                divTemp.innerHTML = html;
                                nodes = divTemp.childNodes;
                                
                                for (var i=0, length=nodes.length; i<length; i+=1) {
                                   fragment.appendChild(nodes[i].cloneNode(true));
                                }
                                
                                el.appendChild(fragment, el.firstChild);
                                
                                nodes    = null;
                                fragment = null;
                                return el;
                            },
            choiceCity  =   function (_this){

                                var city  =  _this.text(),
                                    index =  _this.index(),
                                    _city = _this.attr("city");

                                _this.find("span").addClass("cur").parent("li").siblings().find("span").removeClass("cur");
                                _this.parents(".city-list").hide();
                                $("#city").find("i").removeClass('up').addClass("down");

                                $("#city").find("span").html(city);

                                $("#area").find("span").html("全部").attr("city",_city);
                                $("#j-area-list li:first-child").find("span").addClass("cur").parent("li").siblings().find("span").removeClass("cur");

                                // return index;

                                $("#areaList").children().remove();

                                //areaTpl 
                                var htmlArea = template('areaTpl', window.data[index]);
                                append(areaList, htmlArea);


                                // ajax data

                                // getData();

                            },
            choiceArea  =   function(_this){

                                var area = _this.text(),
                                    city = _this.attr("city");

                                $("#area").find("span").html(area).attr("city",city);

                                _this.find("span").addClass("cur").parent("li").siblings().find("span").removeClass("cur");
                                _this.parents(".area-list").hide();
                                $("#area").find("i").removeClass('up').addClass("down");

                                console.log(city);

                                // ajax data

                            };


        $(function(){

            var cityList  = document.getElementById('cityList');
                

            $.getJSON('/wap/data/ajax_city_array.json', function(data){
                // cityTpl
                var htmlCity = template('cityTpl', data);
                append(cityList, htmlCity);

                window.data = data.data;
                return window.data;

            });



            // 城市区域筛选
            $("#city").click(function(){

                var flag =  $(this).find('i').hasClass("down");

                if(flag){
                    $(this).find('i').removeClass('down').addClass("up");
                    $(".city-list").show();
                    $(".area-list").hide();
                    $("#area").find('i').addClass("down").removeClass('up');
                    
                }else{
                    $(this).find('i').addClass("down").removeClass('up');
                    $(".city-list").hide();
                };

            });

            $("#area").click(function(){

                var flag =  $(this).find('i').hasClass("down");

                if(flag){
                    $(this).find('i').removeClass('down').addClass("up");
                    $(".area-list").show();
                    $(".city-list").hide();
                    $("#city").find('i').addClass("down").removeClass('up');
                    
                }else{
                    $(this).find('i').addClass("down").removeClass('up');
                    $(".area-list").hide();
                };

            });
            

            // 投票处理
            $("button").on("click",function(){
                var flag = $(this).children('i').hasClass('vote');
                if(flag){
                    $(this).children('i').removeClass("vote");
                }else{
                    $(this).children('i').addClass("vote");
                }
            });
        });


     </script>

</body>
</html>
